{"version":3,"names":["cov_2mdw3k1381","actualCoverage","common_1","s","require","axios_1","__importDefault","logger","Logger","sendSlackMessage","payload","token","f","__awaiter","rsp","default","post","headers","Authorization","data","ok","b","error","warning","exports"],"sources":["/home/user/climbox/packages/api/src/utils/slack.utils.ts"],"sourcesContent":["import { Logger } from '@nestjs/common';\r\nimport axios from 'axios';\r\n\r\nconst logger = new Logger('SlackUtils');\r\n\r\nexport interface SlackMessage {\r\n  channel: string;\r\n  text?: string;\r\n  mrkdwn?: boolean;\r\n  blocks?: {\r\n    type: string;\r\n    text?: {\r\n      type: string;\r\n      text: string;\r\n    };\r\n  }[];\r\n}\r\n\r\ninterface SlackResponse {\r\n  ok: boolean;\r\n  error?: string;\r\n  warning?: string;\r\n}\r\n\r\nexport const sendSlackMessage = async (\r\n  payload: SlackMessage,\r\n  token: string,\r\n) => {\r\n  const rsp = await axios.post<SlackResponse>(\r\n    'https://slack.com/api/chat.postMessage',\r\n    payload,\r\n    {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    },\r\n  );\r\n\r\n  const { data } = rsp;\r\n  // Slack returns { ok: false } if an error occurs\r\n  if (!data.ok) {\r\n    logger.error(\r\n      `Slack responded with a non-ok status. Error: '${data.error}'. Warning: '${data.warning}'.`,\r\n    );\r\n  }\r\n};\r\n"],"mappings":"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"}