{"version":3,"names":["common_1","cov_18g1nik03a","s","require","typeorm_1","class_validator_1","EntityExists","constructor","dataSource","f","validate","id","args","b","Number","isNaN","isInteger","MAX_SAFE_INTEGER","found","getRepository","constraints","findOneBy","defaultMessage","name","__decorate","ValidatorConstraint","async","Injectable","DataSource","exports"],"sources":["/home/user/climbox/packages/api/src/validations/entity-exists.constraint.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { DataSource } from 'typeorm';\r\nimport { ValidatorConstraint, ValidationArguments } from 'class-validator';\r\n\r\n@ValidatorConstraint({ name: 'entityExists', async: true })\r\n@Injectable()\r\nexport class EntityExists {\r\n  constructor(private dataSource: DataSource) {}\r\n\r\n  async validate(id: number, args: ValidationArguments) {\r\n    if (typeof id !== 'number' || Number.isNaN(id) || !Number.isInteger(id)) {\r\n      return false;\r\n    }\r\n\r\n    if (id < 1 || id > Number.MAX_SAFE_INTEGER) {\r\n      return false;\r\n    }\r\n\r\n    const found = await this.dataSource\r\n      .getRepository(args.constraints[0])\r\n      .findOneBy({ id });\r\n    if (!found) return false;\r\n    return true;\r\n  }\r\n\r\n  defaultMessage(args: ValidationArguments) {\r\n    return `Foreign-key constraint error on ${args.constraints[0].name}.`;\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAA,QAAA;AAAA;AAAA,CAAAC,cAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAC,SAAA;AAAA;AAAA,CAAAH,cAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAE,iBAAA;AAAA;AAAA,CAAAJ,cAAA,GAAAC,CAAA,QAAAC,OAAA;AAA2E;AAAAF,cAAA,GAAAC,CAAA;AAIpE,IAAMI,YAAY,GAAlB,MAAMA,YAAY;EACvBC,YAAoBC,UAAsB;IAAA;IAAAP,cAAA,GAAAQ,CAAA;IAAAR,cAAA,GAAAC,CAAA;IAAtB,KAAAM,UAAU,GAAVA,UAAU;EAAe;EAEvCE,QAAQA,CAACC,EAAU,EAAEC,IAAyB;IAAA;IAAAX,cAAA,GAAAQ,CAAA;IAAAR,cAAA,GAAAC,CAAA;;;;;MAClD;MAAI;MAAA,CAAAD,cAAA,GAAAY,CAAA,kBAAOF,EAAE,KAAK,QAAQ;MAAA;MAAA,CAAAV,cAAA,GAAAY,CAAA,WAAIC,MAAM,CAACC,KAAK,CAACJ,EAAE,CAAC;MAAA;MAAA,CAAAV,cAAA,GAAAY,CAAA,WAAI,CAACC,MAAM,CAACE,SAAS,CAACL,EAAE,CAAC,GAAE;QAAA;QAAAV,cAAA,GAAAY,CAAA;QAAAZ,cAAA,GAAAC,CAAA;QACvE,OAAO,KAAK;OACb;MAAA;MAAA;QAAAD,cAAA,GAAAY,CAAA;MAAA;MAAAZ,cAAA,GAAAC,CAAA;MAED;MAAI;MAAA,CAAAD,cAAA,GAAAY,CAAA,WAAAF,EAAE,GAAG,CAAC;MAAA;MAAA,CAAAV,cAAA,GAAAY,CAAA,WAAIF,EAAE,GAAGG,MAAM,CAACG,gBAAgB,GAAE;QAAA;QAAAhB,cAAA,GAAAY,CAAA;QAAAZ,cAAA,GAAAC,CAAA;QAC1C,OAAO,KAAK;OACb;MAAA;MAAA;QAAAD,cAAA,GAAAY,CAAA;MAAA;MAED,MAAMK,KAAK;MAAA;MAAA,CAAAjB,cAAA,GAAAC,CAAA,QAAG,MAAM,IAAI,CAACM,UAAU,CAChCW,aAAa,CAACP,IAAI,CAACQ,WAAW,CAAC,CAAC,CAAC,CAAC,CAClCC,SAAS,CAAC;QAAEV;MAAE,CAAE,CAAC;MAAC;MAAAV,cAAA,GAAAC,CAAA;MACrB,IAAI,CAACgB,KAAK,EAAE;QAAA;QAAAjB,cAAA,GAAAY,CAAA;QAAAZ,cAAA,GAAAC,CAAA;QAAA,OAAO,KAAK;MAAA,CAAC;MAAA;MAAA;QAAAD,cAAA,GAAAY,CAAA;MAAA;MAAAZ,cAAA,GAAAC,CAAA;MACzB,OAAO,IAAI;IACb,CAAC;;EAEDoB,cAAcA,CAACV,IAAyB;IAAA;IAAAX,cAAA,GAAAQ,CAAA;IAAAR,cAAA,GAAAC,CAAA;IACtC,OAAO,mCAAmCU,IAAI,CAACQ,WAAW,CAAC,CAAC,CAAC,CAACG,IAAI,GAAG;EACvE;CACD;AAAA;AAAAtB,cAAA,GAAAC,CAAA;AAtBYI,YAAY,GAAAkB,UAAA,EAFxB,IAAAnB,iBAAA,CAAAoB,mBAAmB,EAAC;EAAEF,IAAI,EAAE,cAAc;EAAEG,KAAK,EAAE;AAAI,CAAE,CAAC,EAC1D,IAAA1B,QAAA,CAAA2B,UAAU,GAAE,E,iCAEqBvB,SAAA,CAAAwB,UAAU,G,EAD/BtB,YAAY,CAsBxB;AAAA;AAAAL,cAAA,GAAAC,CAAA;AAtBY2B,OAAA,CAAAvB,YAAA,GAAAA,YAAA"}