{"version":3,"names":["path","cov_18ci88wuhq","s","__importStar","require","lodash_1","mimetypes_1","getRandomName","folder","prefix","file","type","f","extension","extname","randomString","times","random","toString","join","fullname","exports","assignName","req","callback","validateMimetype","mimetype","relativePath","originalname"],"sources":["/home/user/climbox/packages/api/src/uploads/file.decorator.ts"],"sourcesContent":["import { Request } from 'express';\r\nimport * as path from 'path';\r\nimport { random, times } from 'lodash';\r\nimport { validateMimetype } from './mimetypes';\r\n\r\nexport const getRandomName = (\r\n  folder: string,\r\n  prefix: string,\r\n  file: string,\r\n  type: string | undefined,\r\n) => {\r\n  const extension = path.extname(file);\r\n  const randomString = times(16, () => random(15).toString(16)).join('');\r\n  const fullname = `${prefix}-${type}-${randomString}${extension}`;\r\n  return path.join(folder, fullname);\r\n};\r\n\r\nexport function assignName(folder: string, prefix: string) {\r\n  return (\r\n    req: Request,\r\n    file: Express.Multer.File,\r\n    callback: (error: Error | null, filename: string) => void,\r\n  ) => {\r\n    const type = validateMimetype(file.mimetype);\r\n    const relativePath = getRandomName(folder, prefix, file.originalname, type);\r\n    return callback(null, relativePath);\r\n  };\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,MAAAA,IAAA;AAAA;AAAA,CAAAC,cAAA,GAAAC,CAAA,QAAAC,YAAA,CAAAC,OAAA;AACA,MAAAC,QAAA;AAAA;AAAA,CAAAJ,cAAA,GAAAC,CAAA,QAAAE,OAAA;AACA,MAAAE,WAAA;AAAA;AAAA,CAAAL,cAAA,GAAAC,CAAA,QAAAE,OAAA;AAA+C;AAAAH,cAAA,GAAAC,CAAA;AAExC,MAAMK,aAAa,GAAGA,CAC3BC,MAAc,EACdC,MAAc,EACdC,IAAY,EACZC,IAAwB,KACtB;EAAA;EAAAV,cAAA,GAAAW,CAAA;EACF,MAAMC,SAAS;EAAA;EAAA,CAAAZ,cAAA,GAAAC,CAAA,QAAGF,IAAI,CAACc,OAAO,CAACJ,IAAI,CAAC;EACpC,MAAMK,YAAY;EAAA;EAAA,CAAAd,cAAA,GAAAC,CAAA,QAAG,IAAAG,QAAA,CAAAW,KAAK,EAAC,EAAE,EAAE,MAAM;IAAA;IAAAf,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAC,CAAA;IAAA,WAAAG,QAAA,CAAAY,MAAM,EAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC;EAAD,CAAC,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC;EACtE,MAAMC,QAAQ;EAAA;EAAA,CAAAnB,cAAA,GAAAC,CAAA,QAAG,GAAGO,MAAM,IAAIE,IAAI,IAAII,YAAY,GAAGF,SAAS,EAAE;EAAC;EAAAZ,cAAA,GAAAC,CAAA;EACjE,OAAOF,IAAI,CAACmB,IAAI,CAACX,MAAM,EAAEY,QAAQ,CAAC;AACpC,CAAC;AAAC;AAAAnB,cAAA,GAAAC,CAAA;AAVWmB,OAAA,CAAAd,aAAa,GAAAA,aAAA;AAY1B,SAAgBe,UAAUA,CAACd,MAAc,EAAEC,MAAc;EAAA;EAAAR,cAAA,GAAAW,CAAA;EAAAX,cAAA,GAAAC,CAAA;EACvD,OAAO,CACLqB,GAAY,EACZb,IAAyB,EACzBc,QAAyD,KACvD;IAAA;IAAAvB,cAAA,GAAAW,CAAA;IACF,MAAMD,IAAI;IAAA;IAAA,CAAAV,cAAA,GAAAC,CAAA,QAAG,IAAAI,WAAA,CAAAmB,gBAAgB,EAACf,IAAI,CAACgB,QAAQ,CAAC;IAC5C,MAAMC,YAAY;IAAA;IAAA,CAAA1B,cAAA,GAAAC,CAAA,QAAG,IAAAmB,OAAA,CAAAd,aAAa,EAACC,MAAM,EAAEC,MAAM,EAAEC,IAAI,CAACkB,YAAY,EAAEjB,IAAI,CAAC;IAAC;IAAAV,cAAA,GAAAC,CAAA;IAC5E,OAAOsB,QAAQ,CAAC,IAAI,EAAEG,YAAY,CAAC;EACrC,CAAC;AACH;AAAC;AAAA1B,cAAA,GAAAC,CAAA;AAVDmB,OAAA,CAAAC,UAAA,GAAAA,UAAA"}