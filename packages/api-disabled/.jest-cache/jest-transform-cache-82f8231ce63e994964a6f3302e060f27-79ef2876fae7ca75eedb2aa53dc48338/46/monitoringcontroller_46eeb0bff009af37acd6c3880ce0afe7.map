{"version":3,"names":["cov_aep6e0764","actualCoverage","common_1","s","require","swagger_1","auth_decorator_1","users_entity_1","get_monitoring_stats_dto_1","get_sites_overview_dto_1","post_monitoring_metric_dto_1","monitoring_service_1","get_monitoring_last_month_dto_1","MonitoringController","constructor","monitoringService","f","postMonitoringMetric","postMonitoringMetricDto","req","user","getMonitoringStats","getMonitoringStatsDto","res","getMonitoringLastMonth","getMonitoringLastMonthDto","getSurveysReport","surveysReport","getSitesOverview","getSitesOverviewDto","SitesOverview","getSitesStatus","__decorate","Post","ApiOperation","summary","Auth","__param","Body","Req","PostMonitoringMetricDto","Object","Get","AdminLevel","SuperAdmin","SiteManager","Query","Res","GetMonitoringStatsDto","GetMonitoringLastMonthDto","GetSitesOverviewDto","ApiTags","Controller","MonitoringService","exports"],"sources":["/home/user/climbox/packages/api/src/monitoring/monitoring.controller.ts"],"sourcesContent":["import { Body, Controller, Get, Post, Query, Req, Res } from '@nestjs/common';\r\nimport { ApiOperation, ApiTags } from '@nestjs/swagger';\r\nimport { Auth } from 'auth/auth.decorator';\r\nimport { AuthRequest } from 'auth/auth.types';\r\nimport { AdminLevel } from 'users/users.entity';\r\nimport type { Response } from 'express';\r\nimport { GetMonitoringStatsDto } from './dto/get-monitoring-stats.dto';\r\nimport { GetSitesOverviewDto } from './dto/get-sites-overview.dto';\r\nimport { PostMonitoringMetricDto } from './dto/post-monitoring-metric.dto';\r\nimport { MonitoringService } from './monitoring.service';\r\nimport { GetMonitoringLastMonthDto } from './dto/get-monitoring-last-month.dto';\r\n\r\n@ApiTags('Monitoring')\r\n@Controller('monitoring')\r\nexport class MonitoringController {\r\n  constructor(private monitoringService: MonitoringService) {}\r\n\r\n  @Post()\r\n  @ApiOperation({ summary: 'Post a usage metric' })\r\n  @Auth()\r\n  postMonitoringMetric(\r\n    @Body() postMonitoringMetricDto: PostMonitoringMetricDto,\r\n    @Req() req: AuthRequest,\r\n  ) {\r\n    return this.monitoringService.postMonitoringMetric(\r\n      postMonitoringMetricDto,\r\n      req.user,\r\n    );\r\n  }\r\n\r\n  @Get()\r\n  @ApiOperation({ summary: 'Get usage metrics' })\r\n  @Auth(AdminLevel.SuperAdmin, AdminLevel.SiteManager)\r\n  getMonitoringStats(\r\n    @Query() getMonitoringStatsDto: GetMonitoringStatsDto,\r\n    @Req() req: AuthRequest,\r\n    @Res() res: Response,\r\n  ) {\r\n    return this.monitoringService.getMonitoringStats(\r\n      getMonitoringStatsDto,\r\n      req.user,\r\n      res,\r\n    );\r\n  }\r\n\r\n  @Get('last-month')\r\n  @ApiOperation({\r\n    summary:\r\n      'Get monitoring metrics for last month for each site with a spotter',\r\n  })\r\n  @Auth(AdminLevel.SuperAdmin)\r\n  getMonitoringLastMonth(\r\n    @Query() getMonitoringLastMonthDto: GetMonitoringLastMonthDto,\r\n    @Res() res: Response,\r\n  ) {\r\n    return this.monitoringService.getMonitoringLastMonth(\r\n      getMonitoringLastMonthDto,\r\n      res,\r\n    );\r\n  }\r\n\r\n  @Get('surveys-report')\r\n  @ApiOperation({ summary: 'Get surveys report' })\r\n  @Auth(AdminLevel.SuperAdmin)\r\n  getSurveysReport() {\r\n    return this.monitoringService.surveysReport();\r\n  }\r\n\r\n  @Get('sites-overview')\r\n  @ApiOperation({ summary: 'Get Aqualink overview' })\r\n  @Auth(AdminLevel.SuperAdmin)\r\n  getSitesOverview(@Query() getSitesOverviewDto: GetSitesOverviewDto) {\r\n    return this.monitoringService.SitesOverview(getSitesOverviewDto);\r\n  }\r\n\r\n  @Get('sites-status')\r\n  @ApiOperation({ summary: \"Get sites' status\" })\r\n  @Auth(AdminLevel.SuperAdmin)\r\n  getSitesStatus() {\r\n    return this.monitoringService.getSitesStatus();\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}