{"version":3,"names":["common_1","cov_2lqwloul67","s","require","core_1","LevelsGuard","constructor","reflector","f","canActivate","context","isPublic","get","getHandler","b","levels","length","request","switchToHttp","getRequest","user","hasAccess","findIndex","l","adminLevel","__decorate","Injectable","Reflector","exports"],"sources":["/home/user/climbox/packages/api/src/auth/levels.guard.ts"],"sourcesContent":["import { Injectable, CanActivate, ExecutionContext } from '@nestjs/common';\r\nimport { Reflector } from '@nestjs/core';\r\nimport { AdminLevel } from '../users/users.entity';\r\nimport { AuthRequest } from './auth.types';\r\n\r\n@Injectable()\r\nexport class LevelsGuard implements CanActivate {\r\n  constructor(private reflector: Reflector) {}\r\n\r\n  async canActivate(context: ExecutionContext): Promise<boolean> {\r\n    const isPublic = this.reflector.get<boolean>(\r\n      'isPublic',\r\n      context.getHandler(),\r\n    );\r\n    if (isPublic) {\r\n      return true;\r\n    }\r\n    const levels = this.reflector.get<AdminLevel[]>(\r\n      'levels',\r\n      context.getHandler(),\r\n    );\r\n    if (!levels || !levels.length) {\r\n      return true;\r\n    }\r\n    const request = context.switchToHttp().getRequest<AuthRequest>();\r\n    const { user } = request;\r\n    const hasAccess = levels.findIndex((l) => l === user.adminLevel) !== -1;\r\n    return hasAccess;\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}